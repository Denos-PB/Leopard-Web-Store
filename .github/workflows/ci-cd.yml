name: Leopard Web Store CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test-windows:
    name: Test on Windows
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: 3.12

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run Django tests (Windows)
      run: |
        python manage.py test
      env:
        SECRET_KEY: test-secret-key-123
        DEBUG: "True"

  test-ubuntu:
    name: Test on Ubuntu
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: 3.12

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run Django tests (Linux)
      run: |
        python manage.py test
      env:
        SECRET_KEY: test-secret-key-123
        DEBUG: "True"

  deploy-simulation:
    name: Deploy Simulation
    runs-on: ubuntu-latest
    needs: [test-windows, test-ubuntu]  # ‚úÖ –ß–µ–∫–∞—î–º–æ –æ–±–∏–¥–≤–∞ —Ç–µ—Å—Ç–∏
    if: github.ref == 'refs/heads/main'

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: 3.12

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run migrations and collectstatic
      run: |
        python manage.py migrate
        python manage.py collectstatic --noinput
      env:
        SECRET_KEY: test-secret-key-123
        DEBUG: "True"

    - name: Simulate Deployment
      run: |
        echo "üéØ –°–∏–º—É–ª—è—Ü—ñ—è –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
        echo "üìã –ö—Ä–æ–∫–∏, —è–∫—ñ –≤–∏–∫–æ–Ω–∞–≤ –±–∏ —Ä–µ–∞–ª—å–Ω–∏–π –¥–µ–ø–ª–æ–π:"
        echo "1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ SSH ‚úÖ"
        echo "2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É –∑ Git ‚úÖ"
        echo "3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π ‚úÖ"
        echo "4. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π ‚úÖ"
        echo "5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ ‚úÖ"
        echo ""
        echo "üîß –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é –≤–∏–∫–æ–Ω–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:"
        echo "python manage.py runserver"
        echo ""
        echo "‚úÖ –í—Å—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ñ! –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –¥–µ–ø–ª–æ—é"